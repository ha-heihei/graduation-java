"use strict";!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define(t):e.touch=t()}(this,function(){var e,t,n,r,i,o,s,l={};l.PCevts={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touchcancel:"mouseout"},l.hasTouch="ontouchstart"in window,l.getType=function(e){return Object.prototype.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},l.getSelector=function(e){return e.id?"#"+e.id:e.className?"."+e.className.split(/\s+/).join("."):e===document?"body":e.tagName.toLowerCase()},l.matchSelector=function(e,t){return e.webkitMatchesSelector(t)},l.getEventListeners=function(e){return e.listeners},l.getPCevts=function(e){return this.PCevts[e]||e},l.forceReflow=function(){var e="reflowDivBlock",t=document.getElementById(e);t||((t=document.createElement("div")).id=e,document.body.appendChild(t));var n=t.parentNode,r=t.nextSibling;n.removeChild(t),n.insertBefore(t,r)},l.simpleClone=function(e){return Object.create(e)},l.getPosOfEvent=function(e){if(this.hasTouch){for(var t=[],n=null,r=0,i=e.touches.length;r<i;r++)n=e.touches[r],t.push({x:n.pageX,y:n.pageY});return t}return[{x:e.pageX,y:e.pageY}]},l.getDistance=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},l.getFingers=function(e){return e.touches?e.touches.length:1},l.calScale=function(e,t){if(2<=e.length&&2<=t.length){var n=this.getDistance(e[1],e[0]);return this.getDistance(t[1],t[0])/n}return 1},l.getAngle=function(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI},l.getAngle180=function(e,t){var n=Math.atan(-1*(t.y-e.y)/(t.x-e.x))*(180/Math.PI);return n<0?180+n:n},l.getDirectionFromAngle=function(e){var t={up:e<-45&&-135<e,down:45<=e&&e<135,left:135<=e||e<=-135,right:-45<=e&&e<=45};for(var n in t)if(t[n])return n;return null},l.getXYByElement=function(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}},l.reset=function(){0,g=y=m=c=!1,T=!1,S=!(v={})},l.isTouchMove=function(e){return"touchmove"===e.type||"mousemove"===e.type},l.isTouchEnd=function(e){return"touchend"===e.type||"mouseup"===e.type||"touchcancel"===e.type},l.env=(e={},t=navigator.userAgent,n=t.match(/(Android)[\s\/]+([\d\.]+)/),r=t.match(/(iPad|iPhone|iPod)\s+OS\s([\d_\.]+)/),i=t.match(/(Windows\s+Phone)\s([\d\.]+)/),o=/WebKit\/[\d.]+/i.test(t),s=!!r&&(navigator.standalone?o:/Safari/i.test(t)&&!/CriOS/i.test(t)&&!/MQQBrowser/i.test(t)),n&&(e.android=!0,e.version=n[2]),r&&(e.ios=!0,e.version=r[2].replace(/_/g,"."),e.ios7=/^7/.test(e.version),"iPad"===r[1]?e.ipad=!0:"iPhone"===r[1]?(e.iphone=!0,e.iphone5=568==screen.height):"iPod"===r[1]&&(e.ipod=!0)),i&&(e.wp=!0,e.version=i[2],e.wp8=/^8/.test(e.version)),o&&(e.webkit=!0),s&&(e.safari=!0),e);function a(e){var t=e.target;switch(e.type){case"touchstart":case"mousedown":I=[],y=!0,(!v.start||v.start.length<2)&&(v.start=l.getPosOfEvent(e)),2<=l.getFingers(e)&&(A=parseInt(l.getAngle180(v.start[0],v.start[1]),10)),d=Date.now(),E={};var n=t.getBoundingClientRect(),r=document.documentElement;E={top:n.y+(window.pageYOffset||r.scrollTop)-(r.clientTop||0),left:n.x+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0)},O.hold(e);break;case"touchmove":case"mousemove":if(!y||!v.start)return;v.move=l.getPosOfEvent(e),2<=l.getFingers(e)?O.pinch(e):S?O.rotateSingleFinger(e):O.swipe(e);break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":if(!y)return;c?O.pinch(e):S?O.rotateSingleFinger(e):m?O.swipe(e):O.tap(e),l.reset(),C=A=0,e.touches&&1===e.touches.length&&(S=y=!0)}}var f={proxyid:0,proxies:[],trigger:function(e, t, n){var r,i={bubbles:!0,cancelable:!0,detail:n=n||{}};try{"undefined"!=typeof CustomEvent?r=new CustomEvent(t,i):(r=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,n),e&&e.dispatchEvent(r)}catch(e){console.warn("Touch.js is not supported by environment.")}},bind:function(e,t,r){e.listeners=e.listeners||{},e.listeners[t]?e.listeners[t].push(r):e.listeners[t]=[r];function n(e){for(var t in l.env.ios7&&l.forceReflow(),(e.originEvent=e).detail)"type"!==t&&(e[t]=e.detail[t]);e.startRotate=function(){S=!0};var n=r.call(e.target,e);void 0===n||n||(e.stopPropagation(),e.preventDefault())}r.proxy=r.proxy||{},r.proxy[t]?r.proxy[t].push(this.proxyid++):r.proxy[t]=[this.proxyid++],this.proxies.push(n),e.addEventListener&&e.addEventListener(t,n,!1)},unbind:function(t,n,e){if(e){var r=e.proxy[n];r&&r.length&&r.forEach(function(e){t.removeEventListener&&t.removeEventListener(n,this.proxies[this.proxyid],!1)})}else{var i=t.listeners[n];i&&i.length&&i.forEach(function(e){t.removeEventListener(n,e,!1)})}},delegate:function(a,e,c,u){function t(e){var t,n;for(var r in(e.originEvent=e).detail)"type"!==r&&(e[r]=e.detail[r]);e.startRotate=function(){S=!0};var i=l.getSelector(a)+" "+c,o=l.matchSelector(e.target,i),s=l.matchSelector(e.target,i+" "+e.target.nodeName);if(!o&&s){for(l.env.ios7&&l.forceReflow(),t=e.target;!l.matchSelector(t,i);)t=t.parentNode;void 0===(n=u.call(e.target,e))||n||(e.stopPropagation(),e.preventDefault())}else l.env.ios7&&l.forceReflow(),(o||s)&&(void 0===(n=u.call(e.target,e))||n||(e.stopPropagation(),e.preventDefault()))}u.proxy=u.proxy||{},u.proxy[e]?u.proxy[e].push(this.proxyid++):u.proxy[e]=[this.proxyid++],this.proxies.push(t),a.listeners=a.listeners||{},a.listeners[e]?a.listeners[e].push(t):a.listeners[e]=[t],a.addEventListener&&a.addEventListener(e,t,!1)},undelegate:function(t,n,e,r){if(r){var i=r.proxy[n];i.length&&i.forEach(function(e){t.removeEventListener&&t.removeEventListener(n,this.proxies[this.proxyid],!1)})}else{t.listeners[n].forEach(function(e){t.removeEventListener(n,e,!1)})}}},h={tap:!0,doubleTap:!0,tapMaxDistance:10,hold:!0,tapTime:200,holdTime:650,maxDoubleTapInterval:300,swipe:!0,swipeTime:300,swipeMinDistance:18,swipeFactor:5,drag:!0,pinch:!0,minScaleRate:0,minRotationAngle:0},p={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",PINCH_START:"pinchstart",PINCH_END:"pinchend",PINCH:"pinch",PINCH_IN:"pinchin",PINCH_OUT:"pinchout",ROTATION_LEFT:"rotateleft",ROTATION_RIGHT:"rotateright",ROTATION:"rotate",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",SWIPE:"swipe",DRAG:"drag",DRAGSTART:"dragstart",DRAGEND:"dragend",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"doubletap"},v={start:null,move:null,end:null},d=0,m=!1,c=!1,T=!1,E={},y=!1,u=null,g=!1,P=null,w=1,S=!1,I=[],A=0,C=0,x=0,D=null,O={getAngleDiff:function(e){for(var t=parseInt(A-l.getAngle180(e[0],e[1]),10),n=0; 90<Math.abs(t-C)&&n++<50;)C<0?t-=180:t+=180;return C=parseInt(t,10)},pinch:function(e){var t=e.target;if(h.pinch){if(!y)return;if(l.getFingers(e)<2&&!l.isTouchEnd(e))return;var n=l.calScale(v.start,v.move),r=this.getAngleDiff(v.move),i={type:"",originEvent:e,scale:n,rotation:r,direction:0<r?"right":"x",fingersCount:l.getFingers(e)};if(c?l.isTouchMove(e)?(i.fingerStatus="move",f.trigger(t,p.PINCH,i)):l.isTouchEnd(e)&&(i.fingerStatus="end",f.trigger(t,p.PINCH_END,i),l.reset()):(c=!0,i.fingerStatus="start",f.trigger(t,p.PINCH_START,i)),Math.abs(1-n)>h.minScaleRate){var o=l.simpleClone(i);w<n?(w=n-1e-11,f.trigger(t,p.PINCH_OUT,o,!1)):n<w&&(w=n+1e-11,f.trigger(t,p.PINCH_IN,o,!1)),l.isTouchEnd(e)&&(w=1)}if(Math.abs(r)>h.minRotationAngle){var s,a=l.simpleClone(i);s=0<r?p.ROTATION_RIGHT:p.ROTATION_LEFT,f.trigger(t,s,a,!1),f.trigger(t,p.ROTATION,i)}}},rotateSingleFinger:function(e){var t=e.target;if(S&&l.getFingers(e)<2){if(!v.move)return;if(I.length<2){var n=l.getXYByElement(t);I=[{x:n.x+t.offsetWidth/2,y:n.y+t.offsetHeight/2},v.move[0]],A=parseInt(l.getAngle180(I[0],I[1]),10)}var r=[I[0],v.move[0]],i=this.getAngleDiff(r),o={type:"",originEvent:e,rotation:i,direction:0<i?"right":"x",fingersCount:l.getFingers(e)};l.isTouchMove(e)?o.fingerStatus="move":!l.isTouchEnd(e)&&"mouseout"!==e.type||(o.fingerStatus="end",f.trigger(t,p.PINCH_END,o),l.reset());var s=0<i?p.ROTATION_RIGHT:p.ROTATION_LEFT;f.trigger(t,s,o),f.trigger(t,p.ROTATION,o)}},swipe:function(e){var t=e.target;if(y&&v.move&&!(1<l.getFingers(e))){var n=Date.now()-d,r=l.getDistance(v.start[0],v.move[0]),i={x:v.move[0].x-E.x,y:v.move[0].y-E.y},o=l.getAngle(v.start[0],v.move[0]),s=l.getDirectionFromAngle(o),a=n/1e3,c=10*(10-h.swipeFactor)*a*a,u={type:p.SWIPE,originEvent:e,position:i,direction:s,distance:r,distanceX:v.move[0].x-v.start[0].x,distanceY:v.move[0].y-v.start[0].y,x:v.move[0].x-v.start[0].x,y:v.move[0].y-v.start[0].y,angle:o,duration:n,fingersCount:l.getFingers(e),factor:c};if(h.swipe){var g=function(){var e=p;switch(s){case"up":f.trigger(t,e.SWIPE_UP,u);break;case"down":f.trigger(t,e.SWIPE_DOWN,u);break;case"x":f.trigger(t,e.SWIPE_LEFT,u);break;case"right":f.trigger(t,e.SWIPE_RIGHT,u)}};m?l.isTouchMove(e)?(u.fingerStatus=u.swipe="move",f.trigger(t,p.SWIPING,u),h.swipeTime<n&&n<h.swipeTime+50&&h.swipeMinDistance<r&&(g(),f.trigger(t,p.SWIPE,u,!1))):!l.isTouchEnd(e)&&"mouseout"!==e.type||(u.fingerStatus=u.swipe="end",f.trigger(t,p.SWIPE_END,u),n<h.swipeTime&&h.swipeMinDistance<r&&(g(),f.trigger(t,p.SWIPE,u,!1))):(u.fingerStatus=u.swipe="start",m=!0,f.trigger(t,p.SWIPE_START,u))}h.drag&&(T?l.isTouchMove(e)?(u.fingerStatus=u.swipe="move",f.trigger(t,p.DRAG,u)):l.isTouchEnd(e)&&(u.fingerStatus=u.swipe="end",f.trigger(t,p.DRAGEND,u)):(u.fingerStatus=u.swipe="start",T=!0,f.trigger(t,p.DRAGSTART,u)))}},tap:function(e){var t=e.target;if(h.tap){var n=Date.now(),r=n-d,i=l.getDistance(v.start[0],v.move?v.move[0]:v.start[0]);if(clearTimeout(u),function(){if(D&&h.doubleTap&&d-x<h.maxDoubleTapInterval&&l.getDistance(D,v.start[0])<16)return!0;return!1}())return clearTimeout(P),void f.trigger(t,p.DOUBLE_TAP,{type:p.DOUBLE_TAP,originEvent:e,position:v.start[0]});if(h.tapMaxDistance<i)return;r<h.holdTime&&l.getFingers(e)<=1&&(g=!0,x=n,D=v.start[0],P=setTimeout(function(){f.trigger(t,p.TAP,{type:p.TAP,originEvent:e,fingersCount:l.getFingers(e),position:D})},h.tapTime))}},hold:function(t){var n=t.target;h.hold&&(clearTimeout(u),u=setTimeout(function(){if(v.start){var e=l.getDistance(v.start[0],v.move?v.move[0]:v.start[0]);h.tapMaxDistance<e||g||f.trigger(n,"hold",{type:"hold",originEvent:t,fingersCount:l.getFingers(t),position:v.start[0]})}},h.holdTime))}};(l.hasTouch?"touchstart touchmove touchend touchcancel":"mouseup mousedown mousemove mouseout").split(" ").forEach(function(e){document.addEventListener(e,a,!1)});var N={};return N.on=N.bind=N.live=function(){var e,n,r,i,t=arguments;if(t.length<2||4<t)return console.error("unexpected arguments!");var o="string"===l.getType(t[0])?document.querySelectorAll(t[0]):t[0];if(o=o.length?Array.prototype.slice.call(o):[o],3===t.length&&"string"===l.getType(t[1]))return e=t[1].split(" "),n=t[2],void e.forEach(function(t){l.hasTouch||(t=l.getPCevts(t)),o.forEach(function(e){f.bind(e,t,n)})});function s(t){l.hasTouch||(t=l.getPCevts(t)),o.forEach(function(e){f.delegate(e,t,i,r[t])})}if(3!==t.length||"object"!==l.getType(t[1]))if(2!==t.length||"object"!==l.getType(t[1])){if(4===t.length&&"object"===l.getType(t[2]))return e=t[1].split(" "),n=t[3],void e.forEach(function(t){l.hasTouch||(t=l.getPCevts(t)),o.forEach(function(e){f.bind(e,t,n)})});if(4===t.length){var a=o[0];return e=t[1].split(" "),i=t[2],n=t[3],void e.forEach(function(e){l.hasTouch||(e=l.getPCevts(e)),f.delegate(a,e,i,n)})}}else for(var c in r=t[1])g(c);else for(var u in r=t[1],i=t[2],r)s(u);function g(t){l.hasTouch||(t=l.getPCevts(t)),o.forEach(function(e){f.bind(e,t,r[t])})}},N.off=N.unbind=N.die=function(){var e,n,r=arguments;if(r.length<1||4<r.length)return console.error("unexpected arguments!");var t="string"===l.getType(r[0])?document.querySelectorAll(r[0]):r[0];if(t=t.length?Array.prototype.slice.call(t):[t],1!==r.length&&2!==r.length){if(3===r.length&&"function"===l.getType(r[2]))return n=r[2],void t.forEach(function(t){(e=r[1].split(" ")).forEach(function(e){l.hasTouch||(e=l.getPCevts(e)),f.unbind(t,e,n)})});if(3!==r.length||"string"!==l.getType(r[2]))return 4===r.length?(n=r[3],void t.forEach(function(t){(e=r[1].split(" ")).forEach(function(e){l.hasTouch||(e=l.getPCevts(e)),f.undelegate(t,e,i,n)})})):void 0;var i=r[2];t.forEach(function(t){(e=r[1].split(" ")).forEach(function(e){l.hasTouch||(e=l.getPCevts(e)),f.undelegate(t,e,i)})})}else t.forEach(function(t){(e=r[1]?r[1].split(" "):Object.keys(t.listeners)).length&&e.forEach(function(e){l.hasTouch||(e=l.getPCevts(e)),f.unbind(t,e),f.undelegate(t,e)})})},N.config=h,N.trigger=function(e,t,n){var r=arguments;l.hasTouch||(t=l.getPCevts(t));var i="string"===l.getType(r[0])?document.querySelectorAll(r[0]):r[0];(i=i.length?Array.prototype.call(i):[i]).forEach(function(e){f.trigger(e,t,n)})},N});